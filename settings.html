<div class="attachment-remover-settings">
    <style>
        /* Enhanced styles for the Attachment Remover extension, inspired by Prose Polisher theme */

        /* Define Nemo-like variables for consistency, with fallbacks */
        :root {
            --nemo-primary-bg: #222;
            --nemo-secondary-bg: #2a2a2a;
            --nemo-tertiary-bg: #1e1e1e;
            --nemo-primary-bg-sub: #1e1e1e; /* Used for group boxes */
            --nemo-border-color: #444;
            --nemo-primary-accent: #6a3d9a; /* Purple */
            --nemo-secondary-accent: #b592e0; /* Lighter purple/pink */
            --nemo-dangerous-color: #e74c3c; /* Red for errors/danger */
            --nemo-text-color: #fff;
            --nemo-text-muted: #999;
            --nemo-item-hover-bg: #333;
            --nemo-shadow-color: rgba(0,0,0,0.5);
            --nemo-success-color: #4CAF50; /* Green for success/help */
            --nemo-info-color: #2196F3; /* Blue for info/footer */

            /* Map original SmartTheme variables to Nemo for compatibility if needed */
            --SmartThemeBodyColor: var(--nemo-secondary-bg);
            --SmartThemeBorderColor: var(--nemo-border-color);
            --SmartThemeQuoteColor: var(--nemo-secondary-accent);
            --SmartThemeEmColor: var(--nemo-text-color);
        }

        /* Main container styling */
        .attachment-remover-settings {
            font-family: var(--font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            color: var(--nemo-text-color);
        }

        /* Header styling with improved visual hierarchy */
        .attachment-remover-settings .inline-drawer-toggle.inline-drawer-header {
            background-color: var(--nemo-secondary-bg);
            border: 1px solid var(--nemo-border-color);
            border-left: 4px solid var(--nemo-primary-accent); /* Main accent color */
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .attachment-remover-settings .inline-drawer-toggle.inline-drawer-header:hover {
            background-color: var(--nemo-item-hover-bg);
            border-left-color: var(--nemo-secondary-accent); /* Lighter accent on hover */
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Content area styling */
        .attachment-remover-settings .inline-drawer-content {
            padding: 16px;
            background: var(--nemo-secondary-bg); /* Consistent background */
            border-radius: 0 0 6px 6px;
            margin-top: -8px;
        }

        /* Description section - adapted to group box style */
        .attachment-remover-description {
            background: var(--nemo-primary-bg-sub);
            border: 1px solid var(--nemo-border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .attachment-remover-description p {
            margin: 0;
            color: var(--nemo-text-color);
            line-height: 1.5;
        }

        /* Form groups and spacing */
        .attachment-remover-settings .form-group {
            margin: 16px 0;
            padding: 8px 0;
        }

        /* Enhanced checkbox styling */
        .attachment-remover-settings .checkbox_label {
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            gap: 12px;
        }

        .attachment-remover-settings .checkbox_label:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .attachment-remover-settings .checkbox_label input[type="checkbox"] {
            margin: 0;
            min-width: 16px;
            height: 16px;
            accent-color: var(--nemo-secondary-accent); /* Use Nemo accent color */
            cursor: pointer;
            margin-top: 2px; /* Align with text */
        }

        /* Setting title and description styling */
        .attachment-remover-settings .setting-title {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .attachment-remover-settings .setting-title strong {
            color: var(--nemo-text-color);
            font-size: 14px;
            line-height: 1.3;
        }

        .attachment-remover-settings .setting-title small {
            color: var(--nemo-text-muted); /* Muted text color */
            font-size: 12px;
            line-height: 1.4;
            opacity: 0.8;
        }

        /* Advanced section styling - adapted to group box style */
        .attachment-remover-advanced {
            background: var(--nemo-primary-bg-sub);
            border: 1px solid var(--nemo-border-color);
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .attachment-remover-advanced h4 {
            margin: 0 0 12px 0;
            color: var(--nemo-text-color);
            font-size: 16px;
            font-weight: 600;
        }

        /* Help section styling - adapted to group box style with success color */
        .attachment-remover-help {
            background: rgba(76, 175, 80, 0.1); /* Original green tint */
            border: 1px solid rgba(76, 175, 80, 0.3); /* Original green tint */
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .attachment-remover-help h4 {
            margin: 0 0 12px 0;
            color: var(--nemo-text-color);
            font-size: 16px;
            font-weight: 600;
        }

        .attachment-remover-help details {
            margin-bottom: 12px;
        }

        .attachment-remover-help summary {
            cursor: pointer;
            padding: 8px 0;
            color: var(--nemo-text-color);
            font-weight: 500;
            border-bottom: 1px solid var(--nemo-border-color);
            margin-bottom: 8px;
        }

        .attachment-remover-help summary:hover {
            color: var(--nemo-secondary-accent);
        }

        .attachment-remover-help .help-content {
            padding: 12px 0;
            color: var(--nemo-text-muted);
            line-height: 1.5;
        }

        .attachment-remover-help .help-content p {
            margin: 8px 0;
        }

        .attachment-remover-help .help-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .attachment-remover-help .help-content li {
            margin: 4px 0;
        }

        .attachment-remover-help .help-content ol {
            margin: 8px 0;
            padding-left: 20px;
        }

        .attachment-remover-help .help-content ol li {
            margin: 6px 0;
        }

        /* Code styling */
        .attachment-remover-help .selector-code {
            display: block;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            color: var(--nemo-success-color); /* Green for code */
            overflow-x: auto;
        }

        /* Horizontal rules */
        .attachment-remover-settings hr {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            margin: 20px 0;
            opacity: 0.6;
        }

        /* Footer section - adapted to group box style with info color */
        .attachment-remover-footer {
            background: rgba(33, 150, 243, 0.1); /* Original blue tint */
            border: 1px solid rgba(33, 150, 243, 0.3); /* Original blue tint */
            border-radius: 6px;
            padding: 12px;
            margin-top: 16px;
        }

        .attachment-remover-footer small {
            color: var(--nemo-text-muted);
            font-size: 12px;
            line-height: 1.4;
            display: block;
            margin: 0;
        }

        .attachment-remover-footer strong {
            color: var(--nemo-text-color);
        }

        /* Error state styling - adapted to group box style with dangerous color */
        .attachment-remover-error {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%);
            border: 1px solid rgba(244, 67, 54, 0.4);
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .attachment-remover-error h4 {
            color: var(--nemo-dangerous-color);
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .attachment-remover-error p {
            color: var(--nemo-text-muted);
            margin: 8px 0;
            line-height: 1.5;
        }

        .attachment-remover-error code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #ff9999; /* Lighter red for error code */
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .attachment-remover-settings .inline-drawer-content {
                padding: 12px;
            }
            
            .attachment-remover-settings .checkbox_label {
                padding: 6px;
            }
            
            .attachment-remover-advanced,
            .attachment-remover-help,
            .attachment-remover-description,
            .attachment-remover-footer {
                padding: 12px;
            }
        }

        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            .attachment-remover-settings .inline-drawer-toggle.inline-drawer-header {
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
            
            .attachment-remover-settings .inline-drawer-toggle.inline-drawer-header:hover {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            }
        }

        /* Animation for smooth transitions */
        .attachment-remover-settings .inline-drawer-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Focus styles for accessibility */
        .attachment-remover-settings input[type="checkbox"]:focus {
            outline: 2px solid var(--nemo-secondary-accent);
            outline-offset: 2px;
        }

        .attachment-remover-settings summary:focus {
            outline: 2px solid var(--nemo-secondary-accent);
            outline-offset: 2px;
            border-radius: 3px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .attachment-remover-settings .inline-drawer-toggle.inline-drawer-header {
                border-width: 2px;
            }
            
            .attachment-remover-settings .checkbox_label:hover {
                background-color: rgba(255, 255, 255, 0.1);
            }
            
            .attachment-remover-settings .setting-title small {
                opacity: 1;
            }
        }
    </style>
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>🗑️ Attachment Remover</b>
            <div class="inline-drawer-icon fa-solid fa-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <div class="attachment-remover-description">
                <p>Automatically removes user-sent image/file attachments from the chat after the AI responds. Keeps your chat log clean and reduces memory usage.</p>
            </div>
            
            <hr>
            
            <!-- Main Enable/Disable -->
            <div class="form-group">
                <label class="checkbox_label" for="attachment_remover_enable">
                    <input type="checkbox" id="attachment_remover_enable">
                    <span class="setting-title">
                        <strong>🔧 Enable Attachment Removal</strong>
                        <small>Activates the automatic attachment removal feature</small>
                    </span>
                </label>
            </div>
            
            <hr>
            
            <!-- Removal Scope Options -->
            <div class="form-group">
                <label class="checkbox_label" for="attachment_remover_all_messages">
                    <input type="checkbox" id="attachment_remover_all_messages">
                    <span class="setting-title">
                        <strong>📝 Remove from All User Messages</strong>
                        <small>If enabled, removes attachments from all user messages in the current conversation turn. If disabled, only removes from the most recent user message.</small>
                    </span>
                </label>
            </div>
            
            <div class="form-group">
                <label class="checkbox_label" for="attachment_remover_images_only">
                    <input type="checkbox" id="attachment_remover_images_only">
                    <span class="setting-title">
                        <strong>🖼️ Remove Images Only</strong>
                        <small>Only remove image attachments, leave other file types (documents, audio, etc.) intact</small>
                    </span>
                </label>
            </div>
            
            <div class="form-group">
                <label class="checkbox_label" for="attachment_remover_preserve_first">
                    <input type="checkbox" id="attachment_remover_preserve_first">
                    <span class="setting-title">
                        <strong>🛡️ Preserve First Message</strong>
                        <small>Never remove attachments from the very first message in the conversation</small>
                    </span>
                </label>
            </div>
            
            <hr>
            
            <!-- Advanced Options -->
            <div class="attachment-remover-advanced">
                <h4>⚙️ Advanced Options</h4>
                
                <div class="form-group">
                    <label class="checkbox_label" for="attachment_remover_auto_cleanup">
                        <input type="checkbox" id="attachment_remover_auto_cleanup">
                        <span class="setting-title">
                            <strong>🧹 Auto Cleanup</strong>
                            <small>Automatically trigger chat save/cleanup after removing attachments</small>
                        </span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox_label" for="attachment_remover_debug">
                        <input type="checkbox" id="attachment_remover_debug">
                        <span class="setting-title">
                            <strong>🐛 Debug Mode</strong>
                            <small>Show detailed logging in browser console (F12 → Console tab)</small>
                        </span>
                    </label>
                </div>
            </div>
            
            <hr>
            
            <!-- Help Section -->
            <div class="attachment-remover-help">
                <h4>❓ Troubleshooting</h4>
                <details>
                    <summary><strong>Attachments not disappearing?</strong></summary>
                    <div class="help-content">
                        <p><strong>Common solutions:</strong></p>
                        <ul>
                            <li>Make sure the extension is <strong>enabled</strong> above</li>
                            <li>Check that you're using a supported SillyTavern version</li>
                            <li>Enable <strong>Debug Mode</strong> and check browser console (F12) for errors</li>
                            <li>Try refreshing the page and re-enabling the extension</li>
                        </ul>
                        
                        <p><strong>For developers:</strong></p>
                        <p>If attachments still aren't being removed, the CSS selectors in the extension may need updating for your SillyTavern version. Check the <code>CONFIG.selectors</code> object in <code>index.js</code> and update the selectors to match your HTML structure.</p>
                        
                        <p><strong>Current selectors:</strong></p>
                        <code class="selector-code">
                            chatContainer: '#chat'<br>
                            message: '.mes'<br>
                            attachment: '.mes_img, .attachment_holder, .mes_file, .inline_image, img[src*="user_uploads"]'
                        </code>
                    </div>
                </details>
                
                <details>
                    <summary><strong>How does it work?</strong></summary>
                    <div class="help-content">
                        <p>The extension monitors the chat for new AI messages. When an AI responds, it automatically scans backwards through recent user messages and removes any attachments it finds. This keeps your chat history clean while preserving the conversation text.</p>
                        
                        <p><strong>Processing order:</strong></p>
                        <ol>
                            <li>AI sends a response</li>
                            <li>Extension identifies the conversation "turn"</li>
                            <li>Scans user messages in that turn (backwards from most recent)</li>
                            <li>Removes attachments based on your settings</li>
                            <li>Stops at the previous AI message or conversation start</li>
                        </ol>
                    </div>
                </details>
            </div>
            
            <div class="attachment-remover-footer">
                <small>
                    <strong>💡 Tip:</strong> Enable debug mode if you're experiencing issues. The console logs will help identify what's happening.
                </small>
            </div>
        </div>
    </div>
</div>